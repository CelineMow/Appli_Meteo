<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>Mon application météo</title>
</head>

<body>
    <div class="application-meteo">
        <div class="container">
            <h3 class="brand"> La météo </h3>
            <div>
                <h1 class="temperature"> 16&#176;</h1>
                <div class="heure-ville">
                    <h1 class="nomVille">Londres</h1>
                    <small>
                        <span class="heure">06:09</span>
                        -
                        <span class="date"> Mercredi 27 Mars</span>
                    </small>
                </div>
                <div class="meteo">
                    <i class="fa-regular fa-sun"></i>
                    <span class="condition">Ensoleillé</span>
                </div>
            </div>
        </div>
        <div class="panel">
            <form id="locationInput">
                <input type="text" class="search" placeholder="Rechercher une ville...">
                <button type="submit" class="submit">
                    <i class="fa-solid fa-location-dot"></i>
                </button>
            </form>

            <ul class="Ville">
                <li class="ville">Paris</li>
                <li class="ville">Londres</li>
                <li class="ville">New York</li>
                <li class="ville">Tokyo</li>
            </ul>

            <ul class="details">
                <h4>Météo en détail</h4>
                <li>
                    <span>Nuages</span>
                    <span class="nuage">0%</span>
                </li>
                <li>
                    <span>Humidité</span>
                    <span class="humidite">0%</span>
                </li>
                <li>
                    <span>Vent</span>
                    <span class="vent">0km/h</span>
                </li>
            </ul>
        </div>
    </div>
    <script>
        const app = document.querySelector('.application-meteo');
        const temperature = document.querySelector('.temperature');
        const dateOutPut = document.querySelector('.date');
        const heureOutPut = document.querySelector('.heure');
        const conditionOutPut = document.querySelector('.condition');
        const nomVilleOutPut = document.querySelector('.nomVille');
        const icone = document.querySelector('.icone');
        const cloudOutPut = document.querySelector('.nuage');
        const humidityOutPut = document.querySelector('.humidite');
        const windOutPut = document.querySelector('.vent');
        const form = document.querySelector('#locationInput');
        const search = document.querySelector('.search');
        const btn = document.querySelector('.submit');
        const ville = document.querySelectorAll('.ville');

        let apikey = 'f1739d80d7f0995ce57277d5861a6566';
        let villeInput = 'Londres';
        if (app && temperature && dateOutPut && heureOutPut && conditionOutPut && nomVilleOutPut && icone && cloudOutPut && humidityOutPut && windOutPut && form && search && btn) {
            // Votre code ici
        } else {
            console.error('Certains éléments DOM sont manquants');
        }
        ville.forEach((ville) => {
            ville.addEventListener('click', (e) => {
                villeInput = e.target.innerHTML;
                fetchDonneesMeteo();
                app.style.opacity = "0";
            });
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (search.value.length == 0) {
                alert('Ajoutez une ville dans la barre de recherche');
            } else {
                villeInput = search.value;
                fetchDonneesMeteo();
                search.value = "";
                app.style.opacity = "0";
            }
        });

        function jourDeLaSemaine(jour, mois, annee) {
            const jourSemaine = [
                "Dimanche",
                "Lundi",
                "Mardi",
                "Mercredi",
                "Jeudi",
                "Vendredi",
                "Samedi"
            ];
            return jourSemaine[new Date(`${annee}-${mois}-${jour}`).getDay()];
        }

        function fetchDonneesMeteo() {
            fetch(`https://api.openweathermap.org/data/2.5/weather?q=${villeInput}&appid=${apikey}&units=metric`)

                .then(response => response.json())
                .then(data => {
                    console.log(data);

                    temperature.innerHTML = `${Math.floor(data.main.temp)} °C`;
                    conditionOutPut.innerHTML = data.weather[0].description;
                    const date = new Date(data.dt * 1000); // Convertir la timestamp en millisecondes
                    const a = date.getFullYear();
                    const m = date.getMonth() + 1;
                    const j = date.getDate();
                    const heure = date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

                    dateOutPut.innerHTML = `${jourDeLaSemaine(j, m, a)} ${j} ${m} ${a}`;
                    heureOutPut.innerHTML = heure;
                    nomVilleOutPut.innerHTML = data.name;
                    if (icone !== null) {
                        icone.src = `http://openweathermap.org/img/wn/${data.weather[0].icon}.png`;
                    }

                    if (cloudOutPut) {
                        cloudOutPut.innerHTML = data.clouds.all + "%";
                    } else {
                        console.error("L'élément cloudOutPut est null");
                    }

                    if (humidityOutPut) {
                        humidityOutPut.innerHTML = data.main.humidity + "%";
                    } else {
                        console.error("L'élément humidityOutPut est null");
                    }

                    if (windOutPut) {
                        windOutPut.innerHTML = (data.wind.speed * 3.6).toFixed(2) + " km/h";
                    } else {
                        console.error("L'élément windOutPut est null");
                    }



                    const code = data.weather[0].id;
                    let heureDuJour = "jour";

                    if (code == 1000) {
                        app.style.backgroundImage = `url(./images/${heureDuJour}/clear.jpg)`;
                        btn.style.background = "#e5ba92";
                        if (heureDuJour == "nuit") {
                            btn.style.background = "#181e27";
                        }
                    } else if (code >= 200 && code < 600) {
                        app.style.backgroundImage = `url(./images/${heureDuJour}/rain.jpg)`;
                        btn.style.background = "#647d75";
                        if (heureDuJour == "nuit") {
                            btn.style.background = "#325c80";
                        }
                    } else if (code >= 600 && code < 700) {
                        app.style.backgroundImage = `url(./images/${heureDuJour}/snow.jpg)`;
                        btn.style.background = "#4d72aa";
                        if (heureDuJour == "nuit") {
                            btn.style.background = "#1b1b1b";
                        }
                    } else if (code >= 700 && code < 800) {
                        app.style.backgroundImage = `url(./images/${heureDuJour}/mist.jpg)`;
                        btn.style.background = "#181e27";
                    } else if (code >= 801 && code <= 804) {
                        app.style.backgroundImage = `url(./images/${heureDuJour}/cloudy.jpg)`;
                        btn.style.background = "#181e27";
                    }

                    app.style.opacity = "1";
                })

        }

        fetchDonneesMeteo();

        app.style.opacity = "1";
    </script>
    <script src="https://kit.fontawesome.com/6cc5d9a1eb.js" crossorigin="anonymous"></script>
</body>

</html>